<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="jquery/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="jquery/jquery.dataTables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="bootstrap-3.3.5/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="jquery/jquery.dataTables/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="bootstrap-3.3.5/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="bootstrap-3.3.5/css/bootstrap-theme.min.css" />
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<ul class="nav nav-tabs">
		<li class="active"><a href="#upPower" data-toggle="tab">趁势追高</a></li>
		<li><a href="#lowPrice" data-toggle="tab">低价抄底</a></li>
		<li><a href="#downMakeT" data-toggle="tab">大跌做T</a></li>
	</ul>
	<br>
	<div class="tab-content">
		<div class="tab-pane active" id="upPower">
			<div class="row">
				<div class=col-lg-6>
					<div class="input-group">
						<span class="input-group-addon">市营率范围</span> 
						<input type="text" class="form-control" placeholder="MinPE" value="1" id="minPeRatio">
						<input type="text" class="form-control" placeholder="MaxPE" value="100" id="maxPeRatio">
					</div>
				</div>
				<div class=col-lg-6>
						<div class="input-group">
						<span class="input-group-addon">目标价最大跌幅</span> 
						<input type="text" class="form-control" placeholder="MaxDownPercent" value="30" id="maxDownPercent">
					</div>
					<button type="button" class="btn btn-default " id="queryPowerBtn">查询</button>
				</div>

			</div>

	<br>

			<table id="upPowerTable" class="display" width="100%"></table>

		</div>
		<div class="tab-pane" id="lowPrice">
			<div class="row">
				<button type="button" class="btn btn-default " id="getDownPercentBtn">查询</button>
			</div>
			<table id="lowPriceBuyTb" class="display" width="100%"></table>
		</div>
		<div class="tab-pane" id="downMakeT"></div>
	</div>
</body>
<script type="text/javascript">
var restfulContext="/PowerSniffer/rest";

$(document).ready(function() {
	fetchUpstockData();
	$("#queryPowerBtn").on("click",function(){
			$("#queryPowerBtn").prop('disabled', true);
			fetchUpstockData()
			
		});
	
	$("#getDownPercentBtn").on("click",function(){
		$("#getDownPercentBtn").prop('disabled', true);
		fetchDownPercentData();
	});
	setInterval(function(){fetchAlarmStocks();}, 3000);
});
function fetchDownPercentData(){
	var table=$('#lowPriceBuyTb').DataTable( {
		"ajax":restfulContext+"/lowPriceBuyStrategy/getStocksDownPercent",
	    "columns": [
	        { title: "股票名称",data:"stockName"},
	        { title: "买价",data:"alarmBuyPrice" },
	        { title: "卖价" ,data:"alarmSellPrice"},
	        { name:"downPercent",title: "底价跌幅",data:"downPercent" }
	    ],
	    destroy:true
	} );
	table.column(["downPercent:name"]).order("desc").draw();
	table.on( 'xhr.dt', function () {
		$("#getDownPercentBtn").prop('disabled', false);
	} );
	
}
function fetchUpstockData(){
	var minPeRatio=$("#minPeRatio").val();
	var maxPeRatio=$("#maxPeRatio").val();
	var maxDownPercent=$("#maxDownPercent").val();
	var table=$('#upPowerTable').DataTable( {
		"ajax":restfulContext+"/goUpStrategy/getGoUpStockInfo?minPeRatio="+minPeRatio+"&maxPeRatio="+maxPeRatio+"&maxDownPercent="+maxDownPercent,
	    "columns": [
	        { title: "股票名称",data:"stockName"},
	        { name:"power",title: "上涨力道",data:"power" },
	        { title: "涨幅" ,data:"upDownRate"},
	        { title: "市盈率" ,data:"peRatio"},
	        { name:"downPercent",title: "底价跌幅",data:"downPercent" }
	    ],
	    destroy:true
	} );
	table.column(["power:name","downPercent:name"]).order("desc").draw();
	table.on( 'xhr.dt', function () {
		$("#queryPowerBtn").prop('disabled', false);
	} );
}

function fetchAlarmStocks(){
	$.ajax({
		url:restfulContext+"/lowPriceBuyStrategy/getAlarmStocks",
	}).done(function(data){
		if(data!=""){
			alert(data);
		}
	});
}

</script>
</html>